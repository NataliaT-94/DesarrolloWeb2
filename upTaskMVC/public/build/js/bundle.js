obtenerTareas();let tareas=[],filtradas=[];const nuevaTareaBtn=document.querySelector("#agregar-tarea");nuevaTareaBtn.addEventListener("click",(function(){mostrarFormulario()}));const filtros=document.querySelectorAll('#filtros input[type="radio"]');function filtrarTareas(e){const a=e.target.value;filtradas=""!==a?tareas.filter(e=>e.estado===a):[],mostrarTareas()}async function obtenerTareas(){try{const e="/api/tareas?id="+obtenerProyecto(),a=await fetch(e),t=await a.json();tareas=t.tareas,mostrarTareas()}catch(e){console.log(e)}}function mostrarTareas(){limpiarTareas(),totalPendientes(),totalCompletas();const e=filtradas.length?filtradas:tareas;if(0===e.length){const e=document.querySelector("#listado-tareas"),a=document.createElement("LI");a.textContent="No hay Tareas",a.classList.add("no-tareas"),e.appendChild(a)}const a={0:"Pendiente",1:"Completa"};e.forEach(e=>{const t=document.createElement("LI");t.dataset.tareaId=e.id,t.classList.add("tarea");const r=document.createElement("P");r.textContent=e.nombre,r.ondblclick=function(){mostrarFormulario(editar=!0,{...e})};const o=document.createElement("DIV");o.classList.add("opciones");const n=document.createElement("BUTTON");n.classList.add("estado-tarea"),n.classList.add(""+a[e.estado].toLowerCase()),n.textContent=a[e.estado],n.dataset.estadoTarea=e.estado,n.ondblclick=function(){cambiarEstadoTarea({...e})};const s=document.createElement("BUTTON");s.classList.add("eliminar-tarea"),s.dataset.idTarea=e.id,s.textContent="Eliminar",s.ondblclick=function(){confirmarEliminarTarea({...e})},o.appendChild(n),o.appendChild(s),t.appendChild(r),t.appendChild(o);document.querySelector("#listado-tareas").appendChild(t)})}function totalPendientes(){const e=tareas.filter(e=>"0"===e.estado),a=document.querySelector("#pendientes");0===e.length?a.disabled=!0:a.disabled=!1}function totalCompletas(){const e=tareas.filter(e=>"1"===e.estado),a=document.querySelector("#completadas");0===e.length?a.disabled=!0:a.disabled=!1}function mostrarFormulario(e=!1,a={}){const t=document.createElement("DIV");t.classList.add("modal"),t.innerHTML=`\n        <form class="formulario nueva-tarea">\n            <legend>${e?"Editar Tarea":"Añade una nueva tarea"}</legend>\n            <div class="campo">\n                <label>Tarea</label>\n                <input type="text" name="tarea" placeholder="${a.nombre?"Edita la Tarea":"Añadir Tarea al Proyecto Actual"}" id="tarea" value="${a.nombre?a.nombre:""}"/>\n            </div>\n            <div class="opciones">\n                <input type="submit" class="submit-nueva-tarea" value="${a.nombre?"Guardar Cambios":"Añadir Tarea"}"/>\n                <button type="button" class="cerrar-modal">Cancelar</button>\n            </div>\n        </form>\n    `,setTimeout(()=>{document.querySelector(".formulario").classList.add("animar")},0),t.addEventListener("click",(function(r){if(r.preventDefault(),r.target.classList.contains("cerrar-modal")){document.querySelector(".formulario").classList.add("cerrar"),setTimeout(()=>{t.remove()},500)}if(r.target.classList.contains("submit-nueva-tarea")){const t=document.querySelector("#tarea").value.trim();if(""===t)return void mostrarAlerta("El nombre de la tarea es Obligatorio","error",document.querySelector(".formulario legend"));e?(a.nombre=t,actualizarTarea(a)):agregarTarea(t)}})),document.querySelector(".dashboard").appendChild(t)}function mostrarAlerta(e,a,t){const r=document.querySelector(".alerta");r&&r.remove();const o=document.createElement("DIV");o.classList.add("alerta",a),o.textContent=e,t.parentElement.insertBefore(o,t.nextElementSibling),setTimeout(()=>{o.remove()},5e3)}async function agregarTarea(e){const a=new FormData;a.append("nombre",e),a.append("proyectoId",obtenerProyecto());try{const t="http://localhost:3000/api/tarea",r=await fetch(t,{method:"POST",body:a}),o=await r.json();if(mostrarAlerta(o.mensaje,o.tipo,document.querySelector(".formulario legend")),"exito"===o.tipo){const a=document.querySelector(".modal");setTimeout(()=>{a.remove()},1e3);const t={id:String(o.id),nombre:e,estado:"0",proyectoId:o.proyectoId};tareas=[...tareas,t],mostrarTareas()}}catch(e){console.log(e)}}function cambiarEstadoTarea(e){const a="1"===e.estado?"0":"1";e.estado=a,actualizarTarea(e)}async function actualizarTarea(e){const{estado:a,id:t,nombre:r}=e,o=new FormData;o.append("id",t),o.append("nombre",r),o.append("estado",a),o.append("proyectoId",obtenerProyecto());try{const e="http://localhost:3000/api/tarea/actualizar",n=await fetch(e,{method:"POST",body:o}),s=await n.json();if("exito"===s.respuesta.tipo){Swal.fire(s.respuesta.mensaje,s.respuesta.mensaje,"success");const e=document.querySelector(".modal");e&&e.remove(),tareas=tareas.map(e=>(e.id===t&&(e.estado=a,e.nombre=r),e)),mostrarTareas()}}catch(e){console.log(e)}}function confirmarEliminarTarea(e){Swal.fire({title:"Eliminar Tarea?",showCancelButton:!0,confirmButtonText:"Si",cancelButtonText:"No"}).then(a=>{a.isConfirmed&&eliminarTarea(e)})}async function eliminarTarea(e){const{estado:a,id:t,nombre:r}=e,o=new FormData;o.append("id",t),o.append("nombre",r),o.append("estado",a),o.append("proyectoId",obtenerProyecto());try{const a="http://localhost:3000/api/tarea/eliminar",t=await fetch(a,{method:"POST",body:o}),r=await t.json();r.resultado&&(Swal.fire("Eliminado!",r.mensaje,"success"),tareas=tareas.filter(a=>a.id!==e.id),mostrarTareas())}catch(e){console.log(e)}}function obtenerProyecto(){const e=new URLSearchParams(window.location.search);return Object.fromEntries(e.entries()).id}function limpiarTareas(){const e=document.querySelector("#listado-tareas");for(;e.firstChild;)e.removeChild(e.firstChild)}filtros.forEach(e=>{e.addEventListener("input",filtrarTareas)});
//# sourceMappingURL=bundle.js.map
